'use client'
import{Node as u,mergeAttributes as c}from"@tiptap/core";import"@tiptap/pm/state";import m from"katex";var f=u.create({name:"math",inline:!0,group:"inline",atom:!0,selectable:!0,marks:"",addAttributes(){return{latex:""}},addOptions(){return{shouldRender:(t,o)=>{let e=t.doc.resolve(o);return e.parent.isTextblock?e.parent.type.name!=="codeBlock":!1},katexOptions:{throwOnError:!1},HTMLAttributes:{}}},addCommands(){return{setLatex:({latex:t})=>({chain:o,state:e})=>{if(!t)return!1;let{from:n,to:r,$anchor:a}=e.selection;return this.options.shouldRender(e,a.pos)?o().insertContentAt({from:n,to:r},{type:"math",attrs:{latex:t}}).setTextSelection({from:n,to:n+1}).run():!1},unsetLatex:()=>({editor:t,state:o,chain:e})=>{let n=t.getAttributes(this.name).latex;if(typeof n!="string")return!1;let{from:r,to:a}=o.selection;return e().command(({tr:s})=>(s.insertText(n,r,a),!0)).setTextSelection({from:r,to:r+n.length}).run()}}},parseHTML(){return[{tag:`span[data-type="${this.name}"]`}]},renderHTML({node:t,HTMLAttributes:o}){let e=t.attrs.latex??"";return["span",c(o,{"data-type":this.name}),e]},renderText({node:t}){return t.attrs.latex??""},addNodeView(){return({node:t,HTMLAttributes:o,getPos:e,editor:n})=>{let r=document.createElement("span"),a=t.attrs.latex??"";return Object.entries(this.options.HTMLAttributes).forEach(([s,i])=>{r.setAttribute(s,i)}),Object.entries(o).forEach(([s,i])=>{r.setAttribute(s,i)}),r.addEventListener("click",()=>{if(n.isEditable&&typeof e=="function"){let s=e(),i=t.nodeSize;n.commands.setTextSelection({from:s,to:s+i})}}),r.contentEditable="false",r.innerHTML=m.renderToString(a,this.options.katexOptions),{dom:r}}}});export{f as a};
