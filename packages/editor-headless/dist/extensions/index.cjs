'use strict';var core=require('@tiptap/core'),extensionColor=require('@tiptap/extension-color'),extensionHighlight=require('@tiptap/extension-highlight'),extensionHorizontalRule=require('@tiptap/extension-horizontal-rule'),extensionImage=require('@tiptap/extension-image'),extensionLink=require('@tiptap/extension-link'),extensionPlaceholder=require('@tiptap/extension-placeholder'),extensionTaskItem=require('@tiptap/extension-task-item'),extensionTaskList=require('@tiptap/extension-task-list'),extensionTextStyle=require('@tiptap/extension-text-style'),extensionUnderline=require('@tiptap/extension-underline'),starterKit=require('@tiptap/starter-kit'),tiptapMarkdown=require('tiptap-markdown'),react=require('@tiptap/react'),C=require('react-moveable'),jsxRuntime=require('react/jsx-runtime');require('@tiptap/pm/state');var A=require('katex'),reactTweet=require('react-tweet'),extensionCharacterCount=require('@tiptap/extension-character-count'),extensionCodeBlockLowlight=require('@tiptap/extension-code-block-lowlight'),extensionYoutube=require('@tiptap/extension-youtube'),tiptapExtensionGlobalDragHandle=require('tiptap-extension-global-drag-handle'),j=require('@tiptap/suggestion'),J=require('tippy.js'),cmdk=require('cmdk'),jotai=require('jotai'),react$1=require('react');function _interopDefault(e){return e&&e.__esModule?e:{default:e}}var extensionImage__default=/*#__PURE__*/_interopDefault(extensionImage);var extensionLink__default=/*#__PURE__*/_interopDefault(extensionLink);var extensionUnderline__default=/*#__PURE__*/_interopDefault(extensionUnderline);var C__default=/*#__PURE__*/_interopDefault(C);var A__default=/*#__PURE__*/_interopDefault(A);var tiptapExtensionGlobalDragHandle__default=/*#__PURE__*/_interopDefault(tiptapExtensionGlobalDragHandle);var j__default=/*#__PURE__*/_interopDefault(j);var J__default=/*#__PURE__*/_interopDefault(J);var R=core.Extension.create({name:"CustomKeymap",addCommands(){return {selectTextWithinNodeBoundaries:()=>({editor:e,commands:o})=>{let{state:t}=e,{tr:r}=t,n=r.selection.$from.start(),i=r.selection.$to.end();return o.setTextSelection({from:n,to:i})}}},addKeyboardShortcuts(){return {"Mod-a":({editor:e})=>{let{state:o}=e,{tr:t}=o,r=t.selection.from,n=t.selection.to,i=t.selection.$from.start(),s=t.selection.$to.end();return r>i||n<s?(e.chain().selectTextWithinNodeBoundaries().run(),!0):!1}}}}),b=R;var E=()=>{let{editor:e}=react.useCurrentEditor();if(!e?.isActive("image"))return null;let o=()=>{let t=document.querySelector(".ProseMirror-selectednode");if(t){let r=e.state.selection,n=e.commands.setImage;n({src:t.src,width:Number(t.style.width.replace("px","")),height:Number(t.style.height.replace("px",""))}),e.commands.setNodeSelection(r.from);}};return jsxRuntime.jsx(C__default.default,{target:document.querySelector(".ProseMirror-selectednode"),container:null,origin:!1,edge:!1,throttleDrag:0,keepRatio:!0,resizable:!0,throttleResize:0,onResize:({target:t,width:r,height:n,delta:i})=>{i[0]&&(t.style.width=`${r}px`),i[1]&&(t.style.height=`${n}px`);},onResizeEnd:()=>{o();},scalable:!0,throttleScale:0,renderDirections:["w","e"],onScale:({target:t,transform:r})=>{t.style.transform=r;}})};var N=core.Node.create({name:"math",inline:!0,group:"inline",atom:!0,selectable:!0,marks:"",addAttributes(){return {latex:""}},addOptions(){return {shouldRender:(e,o)=>{let t=e.doc.resolve(o);return t.parent.isTextblock?t.parent.type.name!=="codeBlock":!1},katexOptions:{throwOnError:!1},HTMLAttributes:{}}},addCommands(){return {setLatex:({latex:e})=>({chain:o,state:t})=>{if(!e)return !1;let{from:r,to:n,$anchor:i}=t.selection;return this.options.shouldRender(t,i.pos)?o().insertContentAt({from:r,to:n},{type:"math",attrs:{latex:e}}).setTextSelection({from:r,to:r+1}).run():!1},unsetLatex:()=>({editor:e,state:o,chain:t})=>{let r=e.getAttributes(this.name).latex;if(typeof r!="string")return !1;let{from:n,to:i}=o.selection;return t().command(({tr:s})=>(s.insertText(r,n,i),!0)).setTextSelection({from:n,to:n+r.length}).run()}}},parseHTML(){return [{tag:`span[data-type="${this.name}"]`}]},renderHTML({node:e,HTMLAttributes:o}){let t=e.attrs.latex??"";return ["span",core.mergeAttributes(o,{"data-type":this.name}),t]},renderText({node:e}){return e.attrs.latex??""},addNodeView(){return ({node:e,HTMLAttributes:o,getPos:t,editor:r})=>{let n=document.createElement("span"),i=e.attrs.latex??"";return Object.entries(this.options.HTMLAttributes).forEach(([s,a])=>{n.setAttribute(s,a);}),Object.entries(o).forEach(([s,a])=>{n.setAttribute(s,a);}),n.addEventListener("click",()=>{if(r.isEditable&&typeof t=="function"){let s=t(),a=e.nodeSize;r.commands.setTextSelection({from:s,to:s+a});}}),n.contentEditable="false",n.innerHTML=A__default.default.renderToString(i,this.options.katexOptions),{dom:n}}}});var z=/(https?:\/\/)?(www\.)?x\.com\/([a-zA-Z0-9_]{1,15})(\/status\/(\d+))?(\/\S*)?/g,K=/^https?:\/\/(www\.)?x\.com\/([a-zA-Z0-9_]{1,15})(\/status\/(\d+))?(\/\S*)?$/,D=e=>e.match(K),$=({node:e})=>{let t=e?.attrs?.src?.split("/").pop();return t?jsxRuntime.jsx(react.NodeViewWrapper,{children:jsxRuntime.jsx("div",{"data-twitter":"",children:jsxRuntime.jsx(reactTweet.Tweet,{id:t})})}):null},W=core.Node.create({name:"twitter",addOptions(){return {addPasteHandler:!0,HTMLAttributes:{},inline:!1,origin:""}},addNodeView(){return react.ReactNodeViewRenderer($,{attrs:this.options.HTMLAttributes})},inline(){return this.options.inline},group(){return this.options.inline?"inline":"block"},draggable:!0,addAttributes(){return {src:{default:null}}},parseHTML(){return [{tag:"div[data-twitter]"}]},addCommands(){return {setTweet:e=>({commands:o})=>D(e.src)?o.insertContent({type:this.name,attrs:e}):!1}},addPasteRules(){return this.options.addPasteHandler?[core.nodePasteRule({find:z,type:this.type,getAttributes:e=>({src:e.input})})]:[]},renderHTML({HTMLAttributes:e}){return ["div",core.mergeAttributes({"data-twitter":""},e)]}});var V=extensionImage.Image.extend({name:"image",addAttributes(){return {...this.parent?.(),width:{default:null},height:{default:null}}}}),_=V;var c=jotai.atom(""),g=jotai.atom(null);var l=jotai.createStore();var y=react$1.createContext({}),x=({query:e,range:o})=>{let t=jotai.useSetAtom(c,{store:l}),r=jotai.useSetAtom(g,{store:l});return react$1.useEffect(()=>{t(e);},[e,t]),react$1.useEffect(()=>{r(o);},[o,r]),react$1.useEffect(()=>{let n=["ArrowUp","ArrowDown","Enter"],i=s=>{if(n.includes(s.key)){s.preventDefault();let a=document.querySelector("#slash-command");return a&&a.dispatchEvent(new KeyboardEvent("keydown",{key:s.key,cancelable:!0,bubbles:!0})),!1}};return document.addEventListener("keydown",i),()=>{document.removeEventListener("keydown",i);}},[]),jsxRuntime.jsx(y.Consumer,{children:n=>jsxRuntime.jsx(n.Out,{})})},X=react$1.forwardRef(({children:e,className:o,...t},r)=>{let[n,i]=jotai.useAtom(c);return jsxRuntime.jsx(y.Consumer,{children:s=>jsxRuntime.jsx(s.In,{children:jsxRuntime.jsxs(cmdk.Command,{ref:r,onKeyDown:a=>{a.stopPropagation();},id:"slash-command",className:o,...t,children:[jsxRuntime.jsx(cmdk.Command.Input,{value:n,onValueChange:i,style:{display:"none"}}),e]})})})});cmdk.Command.List;X.displayName="EditorCommand";var We=core.Extension.create({name:"slash-command",addOptions(){return {suggestion:{char:"/",command:({editor:e,range:o,props:t})=>{t.command({editor:e,range:o});}}}},addProseMirrorPlugins(){return [j__default.default({editor:this.editor,...this.options.suggestion})]}}),Be=e=>{let o=null,t=null;return {onStart:r=>{o=new react.ReactRenderer(x,{props:r,editor:r.editor});let{selection:n}=r.editor.state;if(n.$from.node(n.$from.depth).type.name==="codeBlock")return !1;t=J__default.default("body",{getReferenceClientRect:r.clientRect,appendTo:()=>e?e.current:document.body,content:o.element,showOnCreate:!0,interactive:!0,trigger:"manual",placement:"bottom-start"});},onUpdate:r=>{o?.updateProps(r),t?.[0]?.setProps({getReferenceClientRect:r.clientRect});},onKeyDown:r=>r.event.key==="Escape"?(t?.[0]?.hide(),!0):o?.ref?.onKeyDown(r),onExit:()=>{t?.[0]?.destroy(),o?.destroy();}}},Ve=e=>e,_e=e=>{if(["ArrowUp","ArrowDown","Enter"].includes(e.key)&&document.querySelector("#slash-command"))return !0};var St=extensionPlaceholder.Placeholder.configure({placeholder:({node:e})=>e.type.name==="heading"?`Heading ${e.attrs.level}`:"Press '/' for commands",includeChildren:!0}),Ot=extensionHighlight.Highlight.configure({multicolor:!0}),vt=tiptapMarkdown.Markdown.configure({html:!1,transformCopiedText:!0}),At=extensionHorizontalRule.HorizontalRule.extend({addInputRules(){return [new core.InputRule({find:/^(?:---|â€”-|___\s|\*\*\*\s)$/u,handler:({state:e,range:o})=>{let t={},{tr:r}=e,n=o.from,i=o.to;r.insert(n-1,this.type.create(t)).delete(r.mapping.map(n),r.mapping.map(i));}})]}});Object.defineProperty(exports,"InputRule",{enumerable:true,get:function(){return core.InputRule}});Object.defineProperty(exports,"Color",{enumerable:true,get:function(){return extensionColor.Color}});Object.defineProperty(exports,"TiptapImage",{enumerable:true,get:function(){return extensionImage__default.default}});Object.defineProperty(exports,"TiptapLink",{enumerable:true,get:function(){return extensionLink__default.default}});Object.defineProperty(exports,"TaskItem",{enumerable:true,get:function(){return extensionTaskItem.TaskItem}});Object.defineProperty(exports,"TaskList",{enumerable:true,get:function(){return extensionTaskList.TaskList}});Object.defineProperty(exports,"TextStyle",{enumerable:true,get:function(){return extensionTextStyle.TextStyle}});Object.defineProperty(exports,"TiptapUnderline",{enumerable:true,get:function(){return extensionUnderline__default.default}});Object.defineProperty(exports,"StarterKit",{enumerable:true,get:function(){return starterKit.StarterKit}});Object.defineProperty(exports,"CharacterCount",{enumerable:true,get:function(){return extensionCharacterCount.CharacterCount}});Object.defineProperty(exports,"CodeBlockLowlight",{enumerable:true,get:function(){return extensionCodeBlockLowlight.CodeBlockLowlight}});Object.defineProperty(exports,"Youtube",{enumerable:true,get:function(){return extensionYoutube.Youtube}});Object.defineProperty(exports,"GlobalDragHandle",{enumerable:true,get:function(){return tiptapExtensionGlobalDragHandle__default.default}});exports.Command=We;exports.CustomKeymap=b;exports.HighlightExtension=Ot;exports.HorizontalRule=At;exports.ImageResizer=E;exports.MarkdownExtension=vt;exports.Mathematics=N;exports.Placeholder=St;exports.Twitter=W;exports.UpdatedImage=_;exports.createSuggestionItems=Ve;exports.handleCommandNavigation=_e;exports.renderItems=Be;