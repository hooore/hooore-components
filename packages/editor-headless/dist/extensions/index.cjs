'use client'
"use strict";var ie=Object.create;var u=Object.defineProperty;var se=Object.getOwnPropertyDescriptor;var ae=Object.getOwnPropertyNames;var me=Object.getPrototypeOf,de=Object.prototype.hasOwnProperty;var ce=(e,r)=>{for(var t in r)u(e,t,{get:r[t],enumerable:!0})},w=(e,r,t,o)=>{if(r&&typeof r=="object"||typeof r=="function")for(let n of ae(r))!de.call(e,n)&&n!==t&&u(e,n,{get:()=>r[n],enumerable:!(o=se(r,n))||o.enumerable});return e};var m=(e,r,t)=>(t=e!=null?ie(me(e)):{},w(r||!e||!e.__esModule?u(t,"default",{value:e,enumerable:!0}):t,e)),le=e=>w(u({},"__esModule",{value:!0}),e);var ve={};ce(ve,{CharacterCount:()=>te.CharacterCount,CodeBlockLowlight:()=>re.CodeBlockLowlight,Color:()=>_.Color,Command:()=>Te,CustomKeymap:()=>E,GlobalDragHandle:()=>ne.default,HighlightExtension:()=>Ee,HorizontalRule:()=>Oe,ImageResizer:()=>v,InputRule:()=>b.InputRule,MarkdownExtension:()=>Se,Mathematics:()=>k,Placeholder:()=>Ce,StarterKit:()=>J.StarterKit,TaskItem:()=>Q.TaskItem,TaskList:()=>Y.TaskList,TextStyle:()=>Z.TextStyle,TiptapImage:()=>G.default,TiptapLink:()=>F.default,TiptapUnderline:()=>j.default,Twitter:()=>P,UpdatedImage:()=>I,Youtube:()=>oe.Youtube,createSuggestionItems:()=>be,handleCommandNavigation:()=>we,renderItems:()=>Re});module.exports=le(ve);var b=require("@tiptap/core"),_=require("@tiptap/extension-color"),q=require("@tiptap/extension-highlight"),U=require("@tiptap/extension-horizontal-rule"),G=m(require("@tiptap/extension-image"),1),F=m(require("@tiptap/extension-link"),1),X=require("@tiptap/extension-placeholder"),Q=require("@tiptap/extension-task-item"),Y=require("@tiptap/extension-task-list"),Z=require("@tiptap/extension-text-style"),j=m(require("@tiptap/extension-underline"),1),J=require("@tiptap/starter-kit"),ee=require("tiptap-markdown");var C=require("@tiptap/core"),pe=C.Extension.create({name:"CustomKeymap",addCommands(){return{selectTextWithinNodeBoundaries:()=>({editor:e,commands:r})=>{let{state:t}=e,{tr:o}=t,n=o.selection.$from.start(),i=o.selection.$to.end();return r.setTextSelection({from:n,to:i})}}},addKeyboardShortcuts(){return{"Mod-a":({editor:e})=>{let{state:r}=e,{tr:t}=r,o=t.selection.from,n=t.selection.to,i=t.selection.$from.start(),s=t.selection.$to.end();return o>i||n<s?(e.chain().selectTextWithinNodeBoundaries().run(),!0):!1}}}}),E=pe;var S=require("@tiptap/react"),O=m(require("react-moveable"),1),A=require("react/jsx-runtime"),v=()=>{let{editor:e}=(0,S.useCurrentEditor)();if(!e?.isActive("image"))return null;let r=()=>{let t=document.querySelector(".ProseMirror-selectednode");if(t){let o=e.state.selection,n=e.commands.setImage;n({src:t.src,width:Number(t.style.width.replace("px","")),height:Number(t.style.height.replace("px",""))}),e.commands.setNodeSelection(o.from)}};return(0,A.jsx)(O.default,{target:document.querySelector(".ProseMirror-selectednode"),container:null,origin:!1,edge:!1,throttleDrag:0,keepRatio:!0,resizable:!0,throttleResize:0,onResize:({target:t,width:o,height:n,delta:i})=>{i[0]&&(t.style.width=`${o}px`),i[1]&&(t.style.height=`${n}px`)},onResizeEnd:()=>{r()},scalable:!0,throttleScale:0,renderDirections:["w","e"],onScale:({target:t,transform:o})=>{t.style.transform=o}})};var f=require("@tiptap/core"),Le=require("@tiptap/pm/state"),N=m(require("katex"),1),k=f.Node.create({name:"math",inline:!0,group:"inline",atom:!0,selectable:!0,marks:"",addAttributes(){return{latex:""}},addOptions(){return{shouldRender:(e,r)=>{let t=e.doc.resolve(r);return t.parent.isTextblock?t.parent.type.name!=="codeBlock":!1},katexOptions:{throwOnError:!1},HTMLAttributes:{}}},addCommands(){return{setLatex:({latex:e})=>({chain:r,state:t})=>{if(!e)return!1;let{from:o,to:n,$anchor:i}=t.selection;return this.options.shouldRender(t,i.pos)?r().insertContentAt({from:o,to:n},{type:"math",attrs:{latex:e}}).setTextSelection({from:o,to:o+1}).run():!1},unsetLatex:()=>({editor:e,state:r,chain:t})=>{let o=e.getAttributes(this.name).latex;if(typeof o!="string")return!1;let{from:n,to:i}=r.selection;return t().command(({tr:s})=>(s.insertText(o,n,i),!0)).setTextSelection({from:n,to:n+o.length}).run()}}},parseHTML(){return[{tag:`span[data-type="${this.name}"]`}]},renderHTML({node:e,HTMLAttributes:r}){let t=e.attrs.latex??"";return["span",(0,f.mergeAttributes)(r,{"data-type":this.name}),t]},renderText({node:e}){return e.attrs.latex??""},addNodeView(){return({node:e,HTMLAttributes:r,getPos:t,editor:o})=>{let n=document.createElement("span"),i=e.attrs.latex??"";return Object.entries(this.options.HTMLAttributes).forEach(([s,a])=>{n.setAttribute(s,a)}),Object.entries(r).forEach(([s,a])=>{n.setAttribute(s,a)}),n.addEventListener("click",()=>{if(o.isEditable&&typeof t=="function"){let s=t(),a=e.nodeSize;o.commands.setTextSelection({from:s,to:s+a})}}),n.contentEditable="false",n.innerHTML=N.default.renderToString(i,this.options.katexOptions),{dom:n}}}});var l=require("@tiptap/core"),h=require("@tiptap/react"),L=require("react-tweet"),g=require("react/jsx-runtime"),ue=/(https?:\/\/)?(www\.)?x\.com\/([a-zA-Z0-9_]{1,15})(\/status\/(\d+))?(\/\S*)?/g,fe=/^https?:\/\/(www\.)?x\.com\/([a-zA-Z0-9_]{1,15})(\/status\/(\d+))?(\/\S*)?$/,ge=e=>e.match(fe),he=({node:e})=>{let t=e?.attrs?.src?.split("/").pop();return t?(0,g.jsx)(h.NodeViewWrapper,{children:(0,g.jsx)("div",{"data-twitter":"",children:(0,g.jsx)(L.Tweet,{id:t})})}):null},P=l.Node.create({name:"twitter",addOptions(){return{addPasteHandler:!0,HTMLAttributes:{},inline:!1,origin:""}},addNodeView(){return(0,h.ReactNodeViewRenderer)(he,{attrs:this.options.HTMLAttributes})},inline(){return this.options.inline},group(){return this.options.inline?"inline":"block"},draggable:!0,addAttributes(){return{src:{default:null}}},parseHTML(){return[{tag:"div[data-twitter]"}]},addCommands(){return{setTweet:e=>({commands:r})=>ge(e.src)?r.insertContent({type:this.name,attrs:e}):!1}},addPasteRules(){return this.options.addPasteHandler?[(0,l.nodePasteRule)({find:ue,type:this.type,getAttributes:e=>({src:e.input})})]:[]},renderHTML({HTMLAttributes:e}){return["div",(0,l.mergeAttributes)({"data-twitter":""},e)]}});var M=require("@tiptap/extension-image"),ye=M.Image.extend({name:"image",addAttributes(){return{...this.parent?.(),width:{default:null},height:{default:null}}}}),I=ye;var te=require("@tiptap/extension-character-count"),re=require("@tiptap/extension-code-block-lowlight"),oe=require("@tiptap/extension-youtube"),ne=m(require("tiptap-extension-global-drag-handle"),1);var $=require("@tiptap/core"),W=require("@tiptap/react"),B=m(require("@tiptap/suggestion"),1),V=m(require("tippy.js"),1);var y=require("cmdk"),p=require("jotai"),d=require("react");var x=require("jotai"),T=(0,x.atom)(""),H=(0,x.atom)(null);var z=require("jotai"),R=(0,z.createStore)();var c=require("react/jsx-runtime"),K=(0,d.createContext)({}),D=({query:e,range:r})=>{let t=(0,p.useSetAtom)(T,{store:R}),o=(0,p.useSetAtom)(H,{store:R});return(0,d.useEffect)(()=>{t(e)},[e,t]),(0,d.useEffect)(()=>{o(r)},[r,o]),(0,d.useEffect)(()=>{let n=["ArrowUp","ArrowDown","Enter"],i=s=>{if(n.includes(s.key)){s.preventDefault();let a=document.querySelector("#slash-command");return a&&a.dispatchEvent(new KeyboardEvent("keydown",{key:s.key,cancelable:!0,bubbles:!0})),!1}};return document.addEventListener("keydown",i),()=>{document.removeEventListener("keydown",i)}},[]),(0,c.jsx)(K.Consumer,{children:n=>(0,c.jsx)(n.Out,{})})},xe=(0,d.forwardRef)(({children:e,className:r,...t},o)=>{let[n,i]=(0,p.useAtom)(T);return(0,c.jsx)(K.Consumer,{children:s=>(0,c.jsx)(s.In,{children:(0,c.jsxs)(y.Command,{ref:o,onKeyDown:a=>{a.stopPropagation()},id:"slash-command",className:r,...t,children:[(0,c.jsx)(y.Command.Input,{value:n,onValueChange:i,style:{display:"none"}}),e]})})})}),We=y.Command.List;xe.displayName="EditorCommand";var Te=$.Extension.create({name:"slash-command",addOptions(){return{suggestion:{char:"/",command:({editor:e,range:r,props:t})=>{t.command({editor:e,range:r})}}}},addProseMirrorPlugins(){return[(0,B.default)({editor:this.editor,...this.options.suggestion})]}}),Re=e=>{let r=null,t=null;return{onStart:o=>{r=new W.ReactRenderer(D,{props:o,editor:o.editor});let{selection:n}=o.editor.state;if(n.$from.node(n.$from.depth).type.name==="codeBlock")return!1;t=(0,V.default)("body",{getReferenceClientRect:o.clientRect,appendTo:()=>e?e.current:document.body,content:r.element,showOnCreate:!0,interactive:!0,trigger:"manual",placement:"bottom-start"})},onUpdate:o=>{r?.updateProps(o),t?.[0]?.setProps({getReferenceClientRect:o.clientRect})},onKeyDown:o=>o.event.key==="Escape"?(t?.[0]?.hide(),!0):r?.ref?.onKeyDown(o),onExit:()=>{t?.[0]?.destroy(),r?.destroy()}}},be=e=>e,we=e=>{if(["ArrowUp","ArrowDown","Enter"].includes(e.key)&&document.querySelector("#slash-command"))return!0};var Ce=X.Placeholder.configure({placeholder:({node:e})=>e.type.name==="heading"?`Heading ${e.attrs.level}`:"Press '/' for commands",includeChildren:!0}),Ee=q.Highlight.configure({multicolor:!0}),Se=ee.Markdown.configure({html:!1,transformCopiedText:!0}),Oe=U.HorizontalRule.extend({addInputRules(){return[new b.InputRule({find:/^(?:---|â€”-|___\s|\*\*\*\s)$/u,handler:({state:e,range:r})=>{let t={},{tr:o}=e,n=r.from,i=r.to;o.insert(n-1,this.type.create(t)).delete(o.mapping.map(n),o.mapping.map(i))}})]}});0&&(module.exports={CharacterCount,CodeBlockLowlight,Color,Command,CustomKeymap,GlobalDragHandle,HighlightExtension,HorizontalRule,ImageResizer,InputRule,MarkdownExtension,Mathematics,Placeholder,StarterKit,TaskItem,TaskList,TextStyle,TiptapImage,TiptapLink,TiptapUnderline,Twitter,UpdatedImage,Youtube,createSuggestionItems,handleCommandNavigation,renderItems});
