'use client'
"use strict";var u=Object.defineProperty;var E=Object.getOwnPropertyDescriptor;var U=Object.getOwnPropertyNames;var b=Object.prototype.hasOwnProperty;var F=(n,e)=>{for(var o in e)u(n,o,{get:e[o],enumerable:!0})},S=(n,e,o,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of U(e))!b.call(n,a)&&a!==o&&u(n,a,{get:()=>e[a],enumerable:!(t=E(e,a))||t.enumerable});return n};var x=n=>S(u({},"__esModule",{value:!0}),n);var V={};F(V,{UploadImagesPlugin:()=>A,createImageUpload:()=>P,handleImageDrop:()=>M,handleImagePaste:()=>C});module.exports=x(V);var p=require("@tiptap/pm/state"),f=require("@tiptap/pm/view"),l=new p.PluginKey("upload-image"),A=({imageClass:n})=>new p.Plugin({key:l,state:{init(){return f.DecorationSet.empty},apply(e,o){o=o.map(e.mapping,e.doc);let t=e.getMeta(this);if(t?.add){let{id:a,pos:c,src:d}=t.add,r=document.createElement("div");r.setAttribute("class","img-placeholder");let i=document.createElement("img");i.setAttribute("class",n),i.src=d,r.appendChild(i);let s=f.Decoration.widget(c+1,r,{id:a});o=o.add(e.doc,[s])}else t?.remove&&(o=o.remove(o.find(void 0,void 0,a=>a.id==t.remove.id)));return o}},props:{decorations(e){return this.getState(e)}}});function I(n,e){let t=l.getState(n).find(void 0,void 0,a=>a.id==e);return t.length?t[0]?.from:null}var P=({validateFn:n,onUpload:e})=>(o,t,a)=>{if(!n?.(o))return;let d={},r=t.state.tr;r.selection.empty||r.deleteSelection();let i=new FileReader;i.readAsDataURL(o),i.onload=()=>{r.setMeta(l,{add:{id:d,pos:a,src:i.result}}),t.dispatch(r)},e(o).then(s=>{let{schema:h}=t.state,m=I(t.state,d);if(m==null)return;let y=typeof s=="object"?i.result:s,g=h.nodes.image?.create({src:y});if(!g)return;let D=t.state.tr.replaceWith(m,m,g).setMeta(l,{remove:{id:d}});t.dispatch(D)},()=>{let s=t.state.tr.delete(a,a).setMeta(l,{remove:{id:d}});t.dispatch(s)})},C=(n,e,o)=>{if(e.clipboardData?.files.length){e.preventDefault();let[t]=Array.from(e.clipboardData.files),a=n.state.selection.from;return t&&o(t,n,a),!0}return!1},M=(n,e,o,t)=>{if(!o&&e.dataTransfer?.files.length){e.preventDefault();let[a]=Array.from(e.dataTransfer.files),c=n.posAtCoords({left:e.clientX,top:e.clientY});return a&&t(a,n,c?.pos??-1),!0}return!1};0&&(module.exports={UploadImagesPlugin,createImageUpload,handleImageDrop,handleImagePaste});
